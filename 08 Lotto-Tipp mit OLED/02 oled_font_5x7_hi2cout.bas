SYMBOL OLED_WIDTH	= 128
SYMBOL OLED_MAX_X	= OLED_WIDTH - 1 ; 127
SYMBOL OLED_HEIGHT = 64
SYMBOL OLED_HEIGHT_LINES	= OLED_HEIGHT / 8 ; 8
SYMBOL OLED_MAX_Y	= OLED_HEIGHT_LINES - 1 ; 7
SYMBOL SSD1306_SETCONTRAST = 0x81
SYMBOL SSD1306_DISPLAYALLON_RESUME = 0xA4
SYMBOL SSD1306_DISPLAYALLON  = 0xA5
SYMBOL SSD1306_NORMALDISPLAY = 0xA6
SYMBOL SSD1306_INVERTDISPLAY = 0xA7
SYMBOL SSD1306_DISPLAYOFF = 0xAE
SYMBOL SSD1306_DISPLAYON = 0xAF	
SYMBOL SSD1306_SETDISPLAYOFFSET = 0xD3
SYMBOL SSD1306_SETCOMPINS = 0xDA	
SYMBOL SSD1306_SETVCOMDETECT = 0xDB	
SYMBOL SSD1306_SETDISPLAYCLOCKDIV = 0xD5
SYMBOL SSD1306_SETPRECHARGE = 0xD9
SYMBOL SSD1306_SETMULTIPLEX = 0xA8	
SYMBOL SSD1306_SETLOWCOLUMN = 0x00
SYMBOL SSD1306_SETHIGHCOLUMN = 0x10
SYMBOL SSD1306_SETSTARTLINE = 0x40
SYMBOL SSD1306_MEMORYMODE = 0x20
SYMBOL SSD1306_COLUMNADDR = 0x21
SYMBOL SSD1306_PAGEADDR = 0x22	; Page 0-7 represents line 0 - 7
SYMBOL SSD1306_COMSCANINC = 0xC0
SYMBOL SSD1306_COMSCANDEC = 0xC8
SYMBOL SSD1306_SEGREMAP = 0xA0 | 1
SYMBOL SSD1306_CHARGEPUMP = 0x8D
SYMBOL SSD1306_EXTERNALVCC = 0x1
SYMBOL SSD1306_SWITCHCAPVCC = 0x2

SYMBOL SSD1306_ADDR  = 0x3C * 2 ; OLED I2C address (0x78)

symbol PICAXE_SPEED = m32
symbol I2C_SPEED = i2cfast_32
symbol DELAY = 1000*8

symbol oled_x1 = b0
symbol oled_y1 = b1
symbol oled_x2 = b2
symbol oled_y2 = b3
symbol oledChar = b4
symbol counter = b5
symbol textAddr = b6
symbol textData = b7
symbol tempVarWord = w4
symbol ch = b10
symbol line = b11

#macro i2c_enable_oled 
hi2csetup i2cmaster, SSD1306_ADDR, I2C_SPEED, i2cbyte
#endmacro

#macro i2c_enable_eeprom
hi2csetup i2cmaster, EEPROM_ADDR, I2C_SPEED, i2cword
#endmacro

#macro OLED_CURSOR(x,y) ; x=column, y=line
oled_y1 = y
oled_x1 = x
oled_y2 = OLED_MAX_Y
oled_x2 = OLED_MAX_X
gosub oledWindow
#endmacro

#macro OLED_WINDOW(x1,y1,x2,y2) ; x1=start column, y1=start line
                                ; x2=end column,y2= end line
oled_y1 = y1
oled_x1 = x1
oled_y2 = y2
oled_x2 = x2
gosub oledWindow
#endmacro

#define OLED_DATA(d) hi2cout (0x40, d)

#macro OLED_PRINTCHAR(c)
oledChar = c
gosub oledPrintChar
#endmacro

#macro OLED_PRINTTEXT(addr)
textAddr = addr
gosub oledPrintText
#endmacro

#define TEXT0 0
EEPROM TEXT0,("OLED 128x64 PIXEL",0) ; 0 als Endezeichen
#define TEXT1 22
EEPROM TEXT1,("FONT ASCII 20-7F:",0) ; 0 als Endezeichen

setfreq PICAXE_SPEED
gosub oledInit
gosub oledClearDisplay

main:
   OLED_CURSOR(0, 0)
   OLED_PRINTTEXT(TEXT0)
   OLED_CURSOR(0, 1)
   OLED_PRINTTEXT(TEXT1)
   gosub showFont
   pause DELAY   
goto main

showFont:
   ch = " "
   for line = 2 to 7
      OLED_CURSOR(0, line)
      for counter = 1 to 16
         OLED_PRINTCHAR(ch)
         ch = ch + 1
      next counter
   next line
return

oledPrintText:
   do
      read textAddr, textData
      if textData <> 0 then
         OLED_PRINTCHAR(textData)
         inc textAddr
      endif
   loop while textData <> 0
return

oledPrintChar:
   oledChar = oledChar - " "
   gosub prepareFont
   hi2cout (0x40, 0x00)
return

prepareFont:
branch oledChar,(char_20, char_21, char_22, char_23, char_24, char_25, char_26, char_27, char_28, char_29, char_2A, char_2B, char_2C, char_2D, char_2E, char_2F, char_30, char_31, char_32, char_33, char_34, char_35, char_36, char_37, char_38, char_39, char_3A, char_3B, char_3C, char_3D, char_3E, char_3F, char_40, char_41, char_42, char_43, char_44, char_45, char_46, char_47, char_48, char_49, char_4A, char_4B, char_4C, char_4D, char_4E, char_4F, char_50, char_51, char_52, char_53, char_54, char_55, char_56, char_57, char_58, char_59, char_5A, char_5B, char_5C, char_5D, char_5E, char_5F, char_60, char_61, char_62, char_63, char_64, char_65, char_66, char_67, char_68, char_69, char_6A, char_6B, char_6C, char_6D, char_6E, char_6F, char_70, char_71, char_72, char_73, char_74, char_75, char_76, char_77, char_78, char_79, char_7A, char_7B, char_7C, char_7D, char_7E, char_7F)

goto char_3F ; print ? for unknown chars

char_20: hi2cout (0x40, 0x00, 0x00, 0x00, 0x00, 0x00) : return ; Space
char_21: hi2cout (0x40, 0x00, 0x00, 0x5F, 0x00, 0x00) : return ; !
char_22: hi2cout (0x40, 0x00, 0x07, 0x00, 0x07, 0x00) : return ; "
char_23: hi2cout (0x40, 0x14, 0x7F, 0x14, 0x7F, 0x14) : return ; #
char_24: hi2cout (0x40, 0x24, 0x2A, 0x7F, 0x2A, 0x12) : return ; $
char_25: hi2cout (0x40, 0x23, 0x13, 0x08, 0x64, 0x62) : return ; %
char_26: hi2cout (0x40, 0x36, 0x49, 0x56, 0x20, 0x50) : return ; &
char_27: hi2cout (0x40, 0x00, 0x08, 0x07, 0x03, 0x00) : return ; '
char_28: hi2cout (0x40, 0x00, 0x1C, 0x22, 0x41, 0x00) : return ; (
char_29: hi2cout (0x40, 0x00, 0x41, 0x22, 0x1C, 0x00) : return ; )
char_2A: hi2cout (0x40, 0x2A, 0x1C, 0x7F, 0x1C, 0x2A) : return ; *
char_2B: hi2cout (0x40, 0x08, 0x08, 0x3E, 0x08, 0x08) : return ; +
char_2C: hi2cout (0x40, 0x00, 0x80, 0x70, 0x30, 0x00) : return ; ,
char_2D: hi2cout (0x40, 0x08, 0x08, 0x08, 0x08, 0x08) : return ; -
char_2E: hi2cout (0x40, 0x00, 0x00, 0x40, 0x00, 0x00) : return ; .
char_2F: hi2cout (0x40, 0x20, 0x10, 0x08, 0x04, 0x02) : return ; /
char_30: hi2cout (0x40, 0x3E, 0x51, 0x49, 0x45, 0x3E) : return ; 0
char_31: hi2cout (0x40, 0x00, 0x42, 0x7F, 0x40, 0x00) : return ; 1
char_32: hi2cout (0x40, 0x72, 0x49, 0x49, 0x49, 0x46) : return ; 2
char_33: hi2cout (0x40, 0x21, 0x41, 0x49, 0x4D, 0x33) : return ; 3
char_34: hi2cout (0x40, 0x18, 0x14, 0x12, 0x7F, 0x10) : return ; 4
char_35: hi2cout (0x40, 0x27, 0x45, 0x45, 0x45, 0x39) : return ; 5
char_36: hi2cout (0x40, 0x3C, 0x4A, 0x49, 0x49, 0x31) : return ; 6
char_37: hi2cout (0x40, 0x41, 0x21, 0x11, 0x09, 0x07) : return ; 7
char_38: hi2cout (0x40, 0x36, 0x49, 0x49, 0x49, 0x36) : return ; 8
char_39: hi2cout (0x40, 0x46, 0x49, 0x49, 0x29, 0x1E) : return ; 9
char_3A: hi2cout (0x40, 0x00, 0x00, 0x14, 0x00, 0x00) : return ; :
char_3B: hi2cout (0x40, 0x00, 0x40, 0x34, 0x00, 0x00) : return ; ;
char_3C: hi2cout (0x40, 0x00, 0x08, 0x14, 0x22, 0x41) : return ; <
char_3D: hi2cout (0x40, 0x14, 0x14, 0x14, 0x14, 0x14) : return ; =
char_3E: hi2cout (0x40, 0x00, 0x41, 0x22, 0x14, 0x08) : return ; >
char_3F: hi2cout (0x40, 0x02, 0x01, 0x59, 0x09, 0x06) : return ; ?
char_40: hi2cout (0x40, 0x3E, 0x41, 0x5D, 0x59, 0x4E) : return ; @
char_41: hi2cout (0x40, 0x7C, 0x12, 0x11, 0x12, 0x7C) : return ; A
char_42: hi2cout (0x40, 0x7F, 0x49, 0x49, 0x49, 0x36) : return ; B
char_43: hi2cout (0x40, 0x3E, 0x41, 0x41, 0x41, 0x22) : return ; C
char_44: hi2cout (0x40, 0x7F, 0x41, 0x41, 0x41, 0x3E) : return ; D
char_45: hi2cout (0x40, 0x7F, 0x49, 0x49, 0x49, 0x41) : return ; E
char_46: hi2cout (0x40, 0x7F, 0x09, 0x09, 0x09, 0x01) : return ; F
char_47: hi2cout (0x40, 0x3E, 0x41, 0x41, 0x51, 0x73) : return ; G
char_48: hi2cout (0x40, 0x7F, 0x08, 0x08, 0x08, 0x7F) : return ; H
char_49: hi2cout (0x40, 0x00, 0x41, 0x7F, 0x41, 0x00) : return ; I
char_4A: hi2cout (0x40, 0x20, 0x40, 0x41, 0x3F, 0x01) : return ; J
char_4B: hi2cout (0x40, 0x7F, 0x08, 0x14, 0x22, 0x41) : return ; K
char_4C: hi2cout (0x40, 0x7F, 0x40, 0x40, 0x40, 0x40) : return ; L
char_4D: hi2cout (0x40, 0x7F, 0x02, 0x1C, 0x02, 0x7F) : return ; M
char_4E: hi2cout (0x40, 0x7F, 0x04, 0x08, 0x10, 0x7F) : return ; N
char_4F: hi2cout (0x40, 0x3E, 0x41, 0x41, 0x41, 0x3E) : return ; O
char_50: hi2cout (0x40, 0x7F, 0x09, 0x09, 0x09, 0x06) : return ; P
char_51: hi2cout (0x40, 0x3E, 0x41, 0x51, 0x21, 0x5E) : return ; Q
char_52: hi2cout (0x40, 0x7F, 0x09, 0x19, 0x29, 0x46) : return ; R
char_53: hi2cout (0x40, 0x26, 0x49, 0x49, 0x49, 0x32) : return ; S
char_54: hi2cout (0x40, 0x03, 0x01, 0x7F, 0x01, 0x03) : return ; T
char_55: hi2cout (0x40, 0x3F, 0x40, 0x40, 0x40, 0x3F) : return ; U
char_56: hi2cout (0x40, 0x1F, 0x20, 0x40, 0x20, 0x1F) : return ; V
char_57: hi2cout (0x40, 0x3F, 0x40, 0x38, 0x40, 0x3F) : return ; W
char_58: hi2cout (0x40, 0x63, 0x14, 0x08, 0x14, 0x63) : return ; X
char_59: hi2cout (0x40, 0x03, 0x04, 0x78, 0x04, 0x03) : return ; Y
char_5A: hi2cout (0x40, 0x61, 0x59, 0x49, 0x4D, 0x43) : return ; Z
char_5B: hi2cout (0x40, 0x00, 0x00, 0x7F, 0x41, 0x00) : return ; [
char_5C: hi2cout (0x40, 0x01, 0x06, 0x18, 0x60, 0x00) : return ; \
char_5D: hi2cout (0x40, 0x00, 0x41, 0x7F, 0x00, 0x00) : return ; ]
char_5E: hi2cout (0x40, 0x18, 0x06, 0x01, 0x06, 0x18) : return ; ^
char_5F: hi2cout (0x40, 0x40, 0x40, 0x40, 0x40, 0x40) : return ; _
char_60: hi2cout (0x40, 0x00, 0x01, 0x02, 0x00, 0x00) : return ; '
char_61: hi2cout (0x40, 0x20, 0x54, 0x54, 0x78, 0x40) : return ; a
char_62: hi2cout (0x40, 0x7F, 0x28, 0x44, 0x44, 0x38) : return ; b
char_63: hi2cout (0x40, 0x38, 0x44, 0x44, 0x44, 0x28) : return ; c
char_64: hi2cout (0x40, 0x38, 0x44, 0x44, 0x28, 0x7F) : return ; d
char_65: hi2cout (0x40, 0x38, 0x54, 0x54, 0x54, 0x18) : return ; e
char_66: hi2cout (0x40, 0x00, 0x08, 0x7E, 0x09, 0x02) : return ; f
char_67: hi2cout (0x40, 0x18, 0xA4, 0xA4, 0x9C, 0x78) : return ; g
char_68: hi2cout (0x40, 0x7F, 0x08, 0x04, 0x04, 0x78) : return ; h
char_69: hi2cout (0x40, 0x00, 0x44, 0x7D, 0x40, 0x00) : return ; i
char_6A: hi2cout (0x40, 0x20, 0x40, 0x40, 0x3D, 0x00) : return ; j
char_6B: hi2cout (0x40, 0x7F, 0x10, 0x28, 0x44, 0x00) : return ; k
char_6C: hi2cout (0x40, 0x00, 0x41, 0x7F, 0x40, 0x00) : return ; l
char_6D: hi2cout (0x40, 0x7C, 0x04, 0x78, 0x04, 0x78) : return ; m
char_6E: hi2cout (0x40, 0x7C, 0x08, 0x04, 0x04, 0x78) : return ; n
char_6F: hi2cout (0x40, 0x38, 0x44, 0x44, 0x44, 0x38) : return ; o
char_70: hi2cout (0x40, 0xFC, 0x18, 0x24, 0x24, 0x18) : return ; p
char_71: hi2cout (0x40, 0x18, 0x24, 0x24, 0x18, 0xFC) : return ; q
char_72: hi2cout (0x40, 0x7C, 0x08, 0x04, 0x04, 0x08) : return ; r
char_73: hi2cout (0x40, 0x48, 0x54, 0x54, 0x54, 0x24) : return ; s
char_74: hi2cout (0x40, 0x04, 0x04, 0x3F, 0x44, 0x24) : return ; t
char_75: hi2cout (0x40, 0x3C, 0x40, 0x40, 0x20, 0x7C) : return ; u
char_76: hi2cout (0x40, 0x1C, 0x20, 0x40, 0x20, 0x1C) : return ; v
char_77: hi2cout (0x40, 0x3C, 0x40, 0x30, 0x40, 0x3C) : return ; w
char_78: hi2cout (0x40, 0x44, 0x28, 0x10, 0x28, 0x44) : return ; x
char_79: hi2cout (0x40, 0x4C, 0x90, 0x90, 0x90, 0x7C) : return ; y
char_7A: hi2cout (0x40, 0x44, 0x64, 0x54, 0x4C, 0x44) : return ; z
char_7B: hi2cout (0x40, 0x00, 0x08, 0x36, 0x41, 0x00) : return ; {
char_7C: hi2cout (0x40, 0x00, 0x00, 0x77, 0x00, 0x00) : return ; |
char_7D: hi2cout (0x40, 0x00, 0x41, 0x36, 0x08, 0x00) : return ; }
char_7E: hi2cout (0x40, 0x02, 0x01, 0x02, 0x04, 0x02) : return ; ~
char_7F: hi2cout (0x40, 0x3C, 0x26, 0x23, 0x26, 0x3C) : return ; 0x7F

return

oledInit:
   i2c_enable_oled
   hi2cout (0, SSD1306_DISPLAYOFF)            ; 0xAE
   hi2cout (0, SSD1306_SETDISPLAYCLOCKDIV)    ; 0xD5
   hi2cout (0, 0x80)                          ; the suggested ratio 0x80
   hi2cout (0, SSD1306_SETMULTIPLEX)          ; 0xA8
   hi2cout (0, 0x3F)
   hi2cout (0, SSD1306_SETDISPLAYOFFSET)      ; 0xD3
   hi2cout (0, 0x0)                           ; no offset
   hi2cout (0, SSD1306_SETSTARTLINE)          ; line #0
   hi2cout (0, SSD1306_CHARGEPUMP)            ; 0x8D
   hi2cout (0, 0x14)     						    ; INTERNAL VCC
   hi2cout (0, SSD1306_MEMORYMODE)            ; 0x20
   hi2cout (0, 0x00)                          ; Horiz mode. 0x0 act like ks0108
   hi2cout (0, SSD1306_SEGREMAP)
   hi2cout (0, SSD1306_COMSCANDEC)
   hi2cout (0, SSD1306_SETCOMPINS)            ; 0xDA
   hi2cout (0, 0x12)
   hi2cout (0, SSD1306_SETCONTRAST)           ; 0x81
   hi2cout (0, 0xCF)						          ; INTERNAL VCC
   hi2cout (0, SSD1306_SETPRECHARGE)          ; 0xD9
   hi2cout (0, 0xF1)						          ; INTERNAL VCC
   hi2cout (0, SSD1306_SETVCOMDETECT)         ; 0xDB
   hi2cout (0, 0x40)
   hi2cout (0, SSD1306_DISPLAYALLON_RESUME)   ; 0xA4
   hi2cout (0, SSD1306_DISPLAYON)         	 ; 0xAF	
return

oledClearDisplay:
   hi2cout (0, SSD1306_PAGEADDR)
   hi2cout (0, 0) ; set row 0
   hi2cout (0, OLED_MAX_Y) ; 7
   hi2cout (0, SSD1306_COLUMNADDR)
   hi2cout (0, 0) ; set column 0
   hi2cout (0, OLED_MAX_X) ; 127
   for tempVarWord = 1 to 32 ; 1024/32
   	hi2cout (0x40, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
   next tempVarWord
return

oledWindow:
   hi2cout (0, SSD1306_PAGEADDR)
   hi2cout (0, oled_y1) ; set row
   hi2cout (0, oled_y2)
   hi2cout (0, SSD1306_COLUMNADDR)
   hi2cout (0, oled_x1) ; set column
   hi2cout (0, oled_x2)
return